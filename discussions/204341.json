[
  {
    "Id": "415994",
    "ThreadId": "204341",
    "Html": "<p><span style=\"font-size:8pt\">Calling the following lines of code in the ASP.Net MVC 2 application generates the error below:</span></p>\r\n<p><span style=\"font-size:8pt\">&nbsp;</span></p>\r\n<p><em><span style=\"font-size:8pt\">\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>Fonet.FonetDriver driver = Fonet.FonetDriver.Make();\r\ndriver.Render(FoPath, OutputPdfPath);\r\n</pre>\r\n</div>\r\n</span></em></p>\r\n<p><span style=\"font-size:8pt\">The file referenced by FoPath variable (&ldquo;<em>Intake_BD10-10001_20103308123353.fo</em>&rdquo;) is created by an XSLT transformation.</span></p>\r\n<p><span style=\"font-size:8pt\">Using the ProcessExplorer from sysinternals.com we discovered that the process holding a file handle to the *.fo file is:</span></p>\r\n<ul>\r\n<li><span style=\"font-size:8pt\"><span style=\"font:7pt 'Times New Roman'\">WebDev.WebServer.exe when running from Visual Studio 2008</span></span></li>\r\n<li><span style=\"font-size:8pt\"><span style=\"font:7pt 'Times New Roman'\">w3wp.exe when running from IIS.</span></span></li>\r\n</ul>\r\n<p><span style=\"font-size:8pt\">Why is the FonetDriver.Render() method failing in this case? <br></span><span style=\"font-size:8pt\">What could be done? <br>Is it a bug? <br>The Render() method should access this *.fo file in readonly mode. What&rsquo;s the problem if another process has a handle on it?</span></p>\r\n<p><span style=\"font-size:8pt\">&nbsp;</span></p>\r\n<p><span style=\"color:red;font-size:18pt\">Server Error in '/' Application. </span></p>\r\n<p><span style=\"color:red;font-size:18pt\">\r\n<hr style=\"color:silver\" size=1>\r\n</span></p>\r\n<p><em><span style=\"color:maroon;font-size:14pt\">System.IO.IOException: The process cannot access the file 'C:\\tst\\Temp\\PdfTest\\PdfTest\\App_Data\\Intake_BD10-10001_20103308123353.fo' because it is being used by another process.<br>&nbsp;&nbsp;at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)<br>&nbsp;&nbsp;at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy)<br>&nbsp;&nbsp;at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize)<br>&nbsp;&nbsp;at System.Xml.XmlDownloadManager.GetStream(Uri uri, ICredentials credentials)<br>&nbsp;&nbsp;at System.Xml.XmlUrlResolver.GetEntity(Uri absoluteUri, String role, Type ofObjectToReturn)<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.OpenUrlDelegate(Object xmlResolver)<br>&nbsp;&nbsp;at System.Threading.CompressedStack.runTryCode(Object userData)<br>&nbsp;&nbsp;at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)<br>&nbsp;&nbsp;at System.Threading.CompressedStack.Run(CompressedStack compressedStack, ContextCallback callback, Object state)<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.OpenUrl()<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.Read()<br>&nbsp;&nbsp;at System.Xml.XmlTextReader.Read()<br>&nbsp;&nbsp;at Fonet.Fo.FOTreeBuilder.Parse(XmlReader reader)</span></em><span style=\"color:maroon;font-size:14pt\"> </span></p>\r\n<p><strong><span style=\"color:black;font-size:8.5pt\">Description: </span></strong><span style=\"color:black;font-size:8.5pt\">An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <br><br></span><strong><span style=\"color:black;font-size:8.5pt\">Exception Details: </span></strong><span style=\"color:black;font-size:8.5pt\">System.SystemException: System.IO.IOException: The process cannot access the file 'C:\\tst\\Temp\\PdfTest\\PdfTest\\App_Data\\Intake_BD10-10001_20103308123353.fo' because it is being used by another process.<br>&nbsp;&nbsp;at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)<br>&nbsp;&nbsp;at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy)<br>&nbsp;&nbsp;at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize)<br>&nbsp;&nbsp;at System.Xml.XmlDownloadManager.GetStream(Uri uri, ICredentials credentials)<br>&nbsp;&nbsp;at System.Xml.XmlUrlResolver.GetEntity(Uri absoluteUri, String role, Type ofObjectToReturn)<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.OpenUrlDelegate(Object xmlResolver)<br>&nbsp;&nbsp;at System.Threading.CompressedStack.runTryCode(Object userData)<br>&nbsp;&nbsp;at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)<br>&nbsp;&nbsp;at System.Threading.CompressedStack.Run(CompressedStack compressedStack, ContextCallback callback, Object state)<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.OpenUrl()<br>&nbsp;&nbsp;at System.Xml.XmlTextReaderImpl.Read()<br>&nbsp;&nbsp;at System.Xml.XmlTextReader.Read()<br>&nbsp;&nbsp;at Fonet.Fo.FOTreeBuilder.Parse(XmlReader reader)<br><br></span><strong><span style=\"color:black;font-size:8.5pt\">Source Error:</span></strong><span style=\"color:black;font-size:8.5pt\"> </span></p>\r\n<table border=0 cellpadding=0 width=\"100%\">\r\n<tbody>\r\n<tr>\r\n<td>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">Line 134:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">Line 135:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fonet.FonetDriver driver = Fonet.FonetDriver.Make();</span></p>\r\n<p><span style=\"color:red;font-size:9pt\">Line 136:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; driver.Render(FOPath, PDFPath);</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">Line 137:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; driver = null;</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">Line 138:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span style=\"color:black;font-size:8.5pt\"><br></span><strong><span style=\"color:black;font-size:8.5pt\">Source File: </span></strong><span style=\"color:black;font-size:8.5pt\">C:\\tst\\Temp\\PdfTest\\PdfTest\\Controllers\\HomeController.cs</span><strong><span style=\"color:black;font-size:8.5pt\"> &nbsp;&nbsp; Line: </span></strong><span style=\"color:black;font-size:8.5pt\">136 <br><br></span><strong><span style=\"color:black;font-size:8.5pt\">Stack Trace:</span></strong><span style=\"color:black;font-size:8.5pt\"> </span></p>\r\n<table border=0 cellpadding=0 width=\"100%\">\r\n<tbody>\r\n<tr>\r\n<td>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">[SystemException: System.IO.IOException: The process cannot access the file 'C:\\tst\\Temp\\PdfTest\\PdfTest\\App_Data\\Intake_BD10-10001_20103308123353.fo' because it is being used by another process.</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlDownloadManager.GetStream(Uri uri, ICredentials credentials)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlUrlResolver.GetEntity(Uri absoluteUri, String role, Type ofObjectToReturn)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlTextReaderImpl.OpenUrlDelegate(Object xmlResolver)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Threading.CompressedStack.runTryCode(Object userData)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Threading.CompressedStack.Run(CompressedStack compressedStack, ContextCallback callback, Object state)</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlTextReaderImpl.OpenUrl()</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlTextReaderImpl.Read()</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at System.Xml.XmlTextReader.Read()</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; at Fonet.Fo.FOTreeBuilder.Parse(XmlReader reader)]</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; Fonet.FonetDriver.FireFonetError(String message) +112</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; Fonet.Fo.FOTreeBuilder.Parse(XmlReader reader) +1088</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; Fonet.FonetDriver.Render(XmlReader inputReader, Stream outputStream) +261</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; Fonet.FonetDriver.Render(String inputFile, String outputFile) +101</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; PdfTest.Controllers.HomeController.PDFGeneration(String FOPath, String PDFPath) in C:\\tst\\Temp\\PdfTest\\PdfTest\\Controllers\\HomeController.cs:136</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; PdfTest.Controllers.HomeController.IntakePDF(String id) in C:\\tst\\Temp\\PdfTest\\PdfTest\\Controllers\\HomeController.cs:97</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; lambda_method(ExecutionScope , ControllerBase , Object[] ) +140</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters) +17</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters) +178</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +24</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClassd.&lt;InvokeActionMethodWithFilters&gt;b__a() +52</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation) +254</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClassf.&lt;InvokeActionMethodWithFilters&gt;b__c() +19</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters(ControllerContext controllerContext, IList`1 filters, ActionDescriptor actionDescriptor, IDictionary`2 parameters) +192</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerActionInvoker.InvokeAction(ControllerContext controllerContext, String actionName) +314</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.Controller.ExecuteCore() +105</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext) +39</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext) +7</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.&lt;&gt;c__DisplayClass8.&lt;BeginProcessRequest&gt;b__4() +34</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.Async.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0() +21</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.Async.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _) +12</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.Async.WrappedAsyncResult`1.End() +59</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult) +44</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result) +7</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +8679150</span></p>\r\n<p><span style=\"color:black;font-size:9pt\">&nbsp;&nbsp; System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +155</span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p><span style=\"color:black;font-size:8.5pt\">&nbsp;</span></p>\r\n<p><span style=\"color:black;font-size:8.5pt\">\r\n<hr style=\"color:silver\" size=1>\r\n</span></p>\r\n<p><strong><span style=\"color:black;font-size:8.5pt\">Version Information:</span></strong><span style=\"color:black;font-size:8.5pt\">&nbsp;Microsoft .NET Framework Version:2.0.50727.4927; ASP.NET Version:2.0.50727.4927</span></p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-03-09T09:22:34.387-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]